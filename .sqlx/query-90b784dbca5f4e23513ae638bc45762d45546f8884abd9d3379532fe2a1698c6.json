{
  "db_name": "PostgreSQL",
  "query": "WITH months AS (SELECT TO_CHAR(month_start, 'Month') AS period,\n                       DATE_PART('month', month_start) AS month_num,\n                       month_start\n                FROM (SELECT DATE_TRUNC('month', NOW()) - INTERVAL '1 month' * (12 - generate_series) AS month_start\n                      FROM GENERATE_SERIES(1, 12)) AS month_series),\n     monthly_listens AS (SELECT TO_CHAR(listened_at, 'Month')   AS period,\n                                DATE_PART('month', listened_at) AS month_num,\n                                DATE_TRUNC('month', listened_at) AS listen_month,\n                                COUNT(*)                        AS listens\n                         FROM scrobbles\n                                  JOIN scrobbles_raw ON scrobbles.source_id = scrobbles_raw.id\n                         WHERE listened_at >= DATE_TRUNC('month', NOW()) - INTERVAL '11 months'\n                           AND listened_at < DATE_TRUNC('month', NOW()) + INTERVAL '1 month'\n                         GROUP BY TO_CHAR(listened_at, 'Month'), DATE_PART('month', listened_at), DATE_TRUNC('month', listened_at))\nSELECT m.period                as period,\n       COALESCE(ml.listens, 0) AS listens\nFROM months m\n         LEFT JOIN monthly_listens ml ON m.month_start = ml.listen_month\nORDER BY m.month_start;\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "period",
        "type_info": "Text"
      },
      {
        "ordinal": 1,
        "name": "listens",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": []
    },
    "nullable": [
      null,
      null
    ]
  },
  "hash": "90b784dbca5f4e23513ae638bc45762d45546f8884abd9d3379532fe2a1698c6"
}
